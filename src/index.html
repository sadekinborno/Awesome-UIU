<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Awesome UIU - Student Resources & Tools</title>
    <link rel="stylesheet" href="css/landing.css">
    <link rel="stylesheet" href="css/responsive.css">
        <link rel="icon" href="assets/icons/uiu-logo.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-background">
            <div class="gradient-overlay"></div>
            <div class="animated-shapes">
                <div class="shape shape-1"></div>
                <div class="shape shape-2"></div>
                <div class="shape shape-3"></div>
            </div>
        </div>
        
        <div class="container">
            <div class="hero-content">
                <div class="hero-badge">
                    <span class="badge-icon"><i class="fa-solid fa-graduation-cap" aria-hidden="true"></i></span>
                    <span>The Awesome UIU</span>
                </div>
                <h1 class="hero-title">
                    Your All-in-One
                    <span class="gradient-text">Student Hub</span>
                </h1>
                <p class="hero-description">
                    Essential tools, resources, and study materials for UIU students - all in one awesome place
                </p>
                <div class="hero-cta">
                    <a href="#tools" class="btn btn-primary">
                        Explore Tools
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </a>
                    <a href="#about" class="btn btn-outline btn-learn-more">Learn More</a>
                    <a href="review-login.html?redirect=index.html" class="btn btn-outline" id="loginBtn" style="display: none;">
                        Login
                    </a>
                    <button class="btn btn-outline" id="userMenuBtn" style="display: none;">
                        üë§ <span id="userEmail"></span>
                    </button>
                </div>

                <div class="mystery-countdown" id="mysteryCountdown" aria-label="Mystery Countdown" style="display: none;">
                    <span class="mystery-countdown-title">Mystery Countdown</span>
                    <span class="mystery-countdown-time" aria-label="Time left" id="mysteryCountdownText">‚Äî</span>
                </div>

                <!-- Global Announcement Modal (admin-published) -->
                <div id="globalAnnouncementModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 9998; align-items: center; justify-content: center;">
                    <div style="position: relative; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 2rem; border-radius: 20px; max-width: 560px; width: 92%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); border: 1px solid rgba(148, 163, 184, 0.2); animation: modalSlideIn 0.3s ease;">
                        <button id="globalAnnouncementClose" aria-label="Close announcement" style="position: absolute; top: 0.75rem; right: 0.75rem; width: 40px; height: 40px; border-radius: 12px; background: transparent; border: 1px solid rgba(148, 163, 184, 0.25); color: #f8fafc; font-size: 1.25rem; font-weight: 800; cursor: pointer;">√ó</button>
                        <div style="margin-bottom: 0.9rem; padding-right: 2.25rem;">
                            <div style="font-size: 1.85rem; line-height: 1.1; font-weight: 900; color: #f8fafc;">Mystery Countdown Ended</div>
                            <div id="globalAnnouncementPublishedAt" style="font-size: 1rem; color: rgba(148, 163, 184, 0.95); margin-top: 0.2rem;">‚Äî</div>
                        </div>

                        <div style="display:flex; flex-direction:column; gap: 1rem;">
                            <div id="globalAnnouncementCountdownEnded" style="display:none; margin-bottom: 0.15rem; color: rgba(248, 250, 252, 0.95); font-weight: 800; text-align: center;">
                                Countdown ended
                            </div>

                            <div id="globalAnnouncementGiftNotice" style="display:none; padding: 0.85rem 0.95rem; border-radius: 14px; background: rgba(34, 197, 94, 0.10); border: 1px solid rgba(34, 197, 94, 0.22); color: rgba(248, 250, 252, 0.95); font-weight: 800; display:flex; align-items:center; gap:0.6rem;">
                                <i class="fa-solid fa-gift" aria-hidden="true" style="color: rgba(134, 239, 172, 0.95);"></i>
                                <span id="globalAnnouncementGiftNoticeText"></span>
                            </div>

                            <div id="globalAnnouncementWinners" style="display:none; padding: 1rem; border-radius: 16px; border: 1px solid rgba(148, 163, 184, 0.18); background: rgba(15, 23, 42, 0.35);">
                                <div style="display:flex; align-items:center; gap:0.55rem; font-weight: 900; margin-bottom: 0.5rem; color: #f8fafc;">
                                    <i class="fa-solid fa-trophy" aria-hidden="true" style="color:#fbbf24;"></i>
                                    Winners / Top contributors
                                </div>
                                <ul id="globalAnnouncementWinnersList" style="margin:0; padding-left: 1.25rem; color: rgba(248, 250, 252, 0.95); text-align: left;"></ul>

                                <details style="margin-top: 0.75rem;">
                                    <summary style="cursor:pointer; color:#cbd5e1; font-size: 0.88rem; font-weight: 700;">How winners are selected</summary>
                                    <ul id="globalAnnouncementCriteriaList" style="margin:0.55rem 0 0; padding-left: 1.1rem; color:#e2e8f0; font-size: 0.88rem; text-align: left;">
                                        <li>Only verified users are considered.</li>
                                        <li>Criteria1: most successful referrals.</li>
                                        <li>Criteria2: most reviews submitted.</li>
                                        <li>Criteria3: most votes cast on reviews.</li>
                                        <li>Tie-breaker: more page visits.</li>
                                    </ul>
                                </details>
                            </div>

                            <div style="display:flex; gap: 1rem; flex-wrap: wrap;">
                                <div id="globalAnnouncementNew" style="display:none; flex: 1; min-width: 240px; padding: 1rem; border-radius: 16px; border: 1px solid rgba(148, 163, 184, 0.18); background: rgba(15, 23, 42, 0.25);">
                                    <div style="display:flex; align-items:center; gap:0.55rem; font-weight: 900; margin-bottom: 0.5rem; color: #f8fafc;">
                                        <i class="fa-solid fa-wand-magic-sparkles" aria-hidden="true" style="color:#a5b4fc;"></i>
                                        Latest features
                                    </div>
                                    <ul id="globalAnnouncementNewList" style="margin:0; padding-left: 1.25rem; color: rgba(248, 250, 252, 0.95); text-align: left;"></ul>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 1.25rem; display:flex; justify-content:flex-end; gap: 0.75rem;">
                            <button id="globalAnnouncementDismiss" style="padding: 0.875rem 1rem; background: transparent; border: 1px solid rgba(148, 163, 184, 0.3); border-radius: 12px; color: #f8fafc; font-size: 1rem; font-weight: 700; cursor: pointer;">Got it</button>
                        </div>
                    </div>
                </div>

                <div class="hero-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="globalVisitCount">0</div>
                        <div class="stat-label">üë• Total Visits</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="scholarshipSubmissions">0</div>
                        <div class="stat-label">üë• Students Registered</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">24/7</div>
                        <div class="stat-label">Access</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Tools Section -->
    <section id="tools" class="tools-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title"><i class="fa-solid fa-screwdriver-wrench" aria-hidden="true"></i> Student Tools</h2>
                <p class="section-description">Powerful calculators and utilities to make your academic life easier</p>
            </div>

            <div class="tools-grid">
                <!-- Teacher Reviews -->
                <a href="teacher-reviews.html" class="tool-card tool-card-featured" style="text-decoration: none; color: inherit;">
                    <div class="tool-badges" aria-label="Teacher reviews highlights">
                        <div class="tool-count-badge" aria-label="Total teacher reviews">
                            <span class="tool-count-number" id="teacherReviewsCount">...</span>
                            <span class="tool-count-label">Reviews</span>
                        </div>
                        <div class="trending-now-badge"><span>Trending Now</span></div>
                    </div>
                    <div class="tool-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <i class="fa-solid fa-star" aria-hidden="true"></i>
                    </div>
                    <div class="tool-content">
                        <h3 class="tool-title">Teacher Reviews</h3>
                        <p class="tool-description">Read and write reviews for UIU teachers based on your course experience.</p>
                        <div class="tool-features">
                            <span class="feature-tag">Write Reviews</span>
                            <span class="feature-tag">Course-based</span>
                        </div>
                    </div>
                    <div class="tool-arrow">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </div>
                </a>

                <!-- CGPA Goal Planner -->
                <a href="goal-planner.html" class="tool-card tool-card-featured">
                    <div class="tool-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <i class="fa-solid fa-bullseye" aria-hidden="true"></i>
                    </div>
                    <div class="tool-content">
                        <h3 class="tool-title">CGPA Goal Planner</h3>
                        <p class="tool-description">Plan your path to your dream CGPA. Find out if it's achievable or if you need a reality check!</p>
                        <div class="tool-features">
                            <span class="feature-tag">Retake Simulator</span>
                            <span class="feature-tag">Beast Mode</span>
                            <span class="feature-tag">Fun GIFs</span>
                        </div>
                    </div>
                    <div class="tool-arrow">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </div>
                </a>

                <!-- CGPA Calculator -->
                <a href="cgpa-calculator.html" class="tool-card tool-card-featured">
                    <div class="tool-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="fa-solid fa-calculator" aria-hidden="true"></i>
                    </div>
                    <div class="tool-content">
                        <h3 class="tool-title">CGPA Calculator</h3>
                        <p class="tool-description">Calculate your cumulative GPA with precision. Track semester performance and plan your grades.</p>
                        <div class="tool-features">
                            <span class="feature-tag">Retake Support</span>
                            <span class="feature-tag">Auto Save</span>
                            <span class="feature-tag">Instant Results</span>
                        </div>
                    </div>
                    <div class="tool-arrow">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </div>
                </a>
                <!-- Academic Calendar -->
                <a href="academic-calendar.html" class="tool-card">
                    <div class="tool-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <i class="fa-solid fa-calendar-days" aria-hidden="true"></i>
                    </div>
                    <div class="tool-content">
                        <h3 class="tool-title">Academic Calendar</h3>
                        <p class="tool-description">All important trimester dates in one place (registration, add/drop, exams, breaks).</p>
                    </div>
                </a>

                <!-- Scholarship Probability Checker -->
                <div class="tool-card tool-card-coming-soon" style="position: relative;">
                    <div class="coming-soon-badge">Coming Soon</div>
                    <div class="tool-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <i class="fa-solid fa-award" aria-hidden="true"></i>
                    </div>
                    <div class="tool-content">
                        <h3 class="tool-title">Scholarship Probability Checker</h3>
                        <p style="margin-top: 0.25rem; margin-bottom: 0; padding: 0.6rem 0.75rem; background: rgba(251, 191, 36, 0.1); border-radius: 8px; font-size: 0.875rem; color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.2);">
                            Launches at <strong>500 registered users</strong> ‚Äî register to unlock.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Resources Section -->
    <section id="resources" class="resources-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title"><i class="fa-solid fa-book-open" aria-hidden="true"></i> Study Resources</h2>
                <p class="section-description">Access curated study materials, notes, and question banks</p>
            </div>

            <div class="resources-grid">
                <!-- Question Banks -->
                <!-- Question Banks -->
                <a href="question-banks.html" class="resource-card">
                    <div class="resource-header">
                        <div class="resource-icon"><i class="fa-solid fa-circle-question" aria-hidden="true"></i></div>
                        <h3 class="resource-title">Question Banks</h3>
                    </div>
                    <p class="resource-description">Past exam questions and practice materials organized by course and semester.</p>
                    <div class="resource-stats">
                        <div class="stat">
                            <span class="stat-value">500+</span>
                            <span class="stat-label">Questions</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">50+</span>
                            <span class="stat-label">Courses</span>
                        </div>
                    </div>
                </a>

                <!-- Lecture Notes -->
                <div class="resource-card resource-card-coming-soon">
                    <div class="coming-soon-badge">Coming Soon</div>
                    <div class="resource-header">
                        <div class="resource-icon"><i class="fa-solid fa-file-lines" aria-hidden="true"></i></div>
                        <h3 class="resource-title">Lecture Notes</h3>
                    </div>
                    <p class="resource-description">Comprehensive notes and summaries shared by students and faculty.</p>
                    <div class="resource-stats">
                        <div class="stat">
                            <span class="stat-value">200+</span>
                            <span class="stat-label">Documents</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">30+</span>
                            <span class="stat-label">Subjects</span>
                        </div>
                    </div>
                </div>

                <!-- Study Guides -->
                <div class="resource-card resource-card-coming-soon">
                    <div class="coming-soon-badge">Coming Soon</div>
                    <div class="resource-header">
                        <div class="resource-icon"><i class="fa-solid fa-book-open" aria-hidden="true"></i></div>
                        <h3 class="resource-title">Study Guides</h3>
                    </div>
                    <p class="resource-description">Curated study guides and reference materials for better understanding.</p>
                    <div class="resource-stats">
                        <div class="stat">
                            <span class="stat-value">100+</span>
                            <span class="stat-label">Guides</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">15+</span>
                            <span class="stat-label">Topics</span>
                        </div>
                    </div>
                </div>

                <!-- Books & References -->
                <div class="resource-card resource-card-coming-soon">
                    <div class="coming-soon-badge">Coming Soon</div>
                    <div class="resource-header">
                        <div class="resource-icon"><i class="fa-solid fa-book" aria-hidden="true"></i></div>
                        <h3 class="resource-title">Books & References</h3>
                    </div>
                    <p class="resource-description">Essential textbooks and reference materials for your courses.</p>
                    <div class="resource-stats">
                        <div class="stat">
                            <span class="stat-value">150+</span>
                            <span class="stat-label">Books</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">All</span>
                            <span class="stat-label">Departments</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about-section">
        <div class="container">
            <div class="about-content">
                <div class="about-text">
                    <h2 class="section-title">About The Awesome UIU</h2>
                    <p class="about-description">
                        The Awesome UIU is a student-driven initiative to centralize all the tools and resources 
                        that UIU students need. From academic calculators to study materials, we're building 
                        a comprehensive platform to support your academic journey.
                    </p>
                    <div class="about-features">
                        <div class="feature-item">
                            <span class="feature-icon"><i class="fa-solid fa-wand-magic-sparkles" aria-hidden="true"></i></span>
                            <div>
                                <h4>Student-First Design</h4>
                                <p>Built by students, for students</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon"><i class="fa-solid fa-shield-halved" aria-hidden="true"></i></span>
                            <div>
                                <h4>Privacy Focused</h4>
                                <p>Your data stays on your device</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon"><i class="fa-solid fa-rocket" aria-hidden="true"></i></span>
                            <div>
                                <h4>Always Improving</h4>
                                <p>New features added regularly</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="about-visual">
                    <div class="visual-card">
                        <div class="visual-icon"><i class="fa-solid fa-bullseye" aria-hidden="true"></i></div>
                        <h3>Our Mission</h3>
                        <p>To make UIU students' academic lives awesome with the best digital tools and resources.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3><i class="fa-solid fa-graduation-cap" aria-hidden="true"></i> The Awesome UIU</h3>
                    <p>Making university life awesome, one tool at a time</p>
                </div>
                <div class="footer-links">
                    <a href="#tools">Tools</a>
                    <a href="#resources">Resources</a>
                    <a href="#about">About</a>
                    <a href="https://github.com/sadekinborno/Awesome-UIU" target="_blank" rel="noopener noreferrer">GitHub</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 The Awesome UIU. Made with ‚ù§Ô∏è for UIU students.</p>
            </div>
        </div>
    </footer>

    <!-- Logout Modal -->
    <div id="logoutModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 9999; align-items: center; justify-content: center;">
        <div style="position: relative; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 2rem; border-radius: 20px; max-width: 400px; width: 90%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); border: 1px solid rgba(148, 163, 184, 0.2); animation: modalSlideIn 0.3s ease;">
            <button id="closeLogout" aria-label="Close" style="position: absolute; top: 0.75rem; right: 0.75rem; width: 40px; height: 40px; border-radius: 12px; background: transparent; border: 1px solid rgba(148, 163, 184, 0.25); color: #f8fafc; font-size: 1.25rem; font-weight: 700; cursor: pointer;">
                √ó
            </button>
            <div style="text-align: center; margin-bottom: 1.5rem;">
                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 1.6rem; margin-bottom: 1rem; color: #ffffff;">
                    <i class="fa-solid fa-right-from-bracket" aria-hidden="true"></i>
                </div>
                <h2 style="color: #f8fafc; font-size: 1.5rem; margin-bottom: 0.5rem;">Logout</h2>
                <p style="color: #94a3b8; font-size: 0.95rem;">Manage your session</p>
            </div>
            <div style="display: grid; gap: 1rem;">
                <button id="copyReferralModalBtn" style="width: 100%; padding: 0.875rem; background: transparent; border: 1px solid rgba(148, 163, 184, 0.3); border-radius: 12px; color: #f8fafc; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                    Copy Referral Link
                </button>
                <button id="showMysteryResultModalBtn" style="width: 100%; padding: 0.875rem; background: transparent; border: 1px solid rgba(148, 163, 184, 0.3); border-radius: 12px; color: #f8fafc; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                    Show Mystery Result
                </button>
                <div id="accountModalFeedback" style="display:none; padding: 0.75rem 0.875rem; border-radius: 12px; border: 1px solid rgba(148, 163, 184, 0.25); background: rgba(2, 6, 23, 0.6); color: #f8fafc; font-size: 0.95rem;">
                    
                </div>
                <button id="confirmLogout" style="width: 100%; padding: 0.875rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 12px; color: white; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                    Logout
                </button>
            </div>
        </div>
    </div>

    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/review-auth.js"></script>
    <script src="js/user-activity.js"></script>
    
    <style>
        /* Glowing Border Animation for Login Button */
        @keyframes glow-border {
            0%, 100% { 
                box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
                border-color: rgba(102, 126, 234, 0.3);
            }
            50% { 
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.8), 0 0 30px rgba(118, 75, 162, 0.6);
                border-color: rgba(102, 126, 234, 1);
            }
        }

        #loginBtn.animate-glow {
            animation: glow-border 3s ease-in-out infinite;
            animation-delay: 2s;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        /* Stop animation on hover */
        #loginBtn.animate-glow:hover {
            animation: none;
        }

        /* Modal Animation */
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header Coachmark */
        #headerCoachmark {
            position: fixed;
            z-index: 10001;
            max-width: 320px;
            padding: 0.8rem 0.95rem;
            border-radius: 14px;
            border: 1px solid rgba(148, 163, 184, 0.28);
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.96) 0%, rgba(30, 41, 59, 0.96) 100%);
            color: #f8fafc;
            box-shadow: 0 14px 40px rgba(2, 6, 23, 0.45);
            display: none;
        }

        #headerCoachmarkText {
            display: block;
            font-size: 0.92rem;
            line-height: 1.45;
            font-weight: 600;
            color: rgba(241, 245, 249, 0.95);
            padding-right: 1.65rem;
        }

        #headerCoachmarkClose {
            position: absolute;
            top: 0.42rem;
            right: 0.42rem;
            width: 26px;
            height: 26px;
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.22);
            background: transparent;
            color: #cbd5e1;
            font-size: 0.92rem;
            font-weight: 700;
            cursor: pointer;
            line-height: 1;
        }

        #headerCoachmark::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background: rgba(20, 30, 48, 0.98);
            border-left: 1px solid rgba(148, 163, 184, 0.28);
            border-top: 1px solid rgba(148, 163, 184, 0.28);
            transform: rotate(45deg);
        }

        #headerCoachmark[data-side='bottom']::after {
            top: -7px;
            left: var(--coachmark-arrow-left, 24px);
        }

        #headerCoachmark[data-side='top']::after {
            bottom: -7px;
            left: var(--coachmark-arrow-left, 24px);
            transform: rotate(225deg);
        }
    </style>
    
    <script>
        // Check if user is logged in and show appropriate button
        document.addEventListener('DOMContentLoaded', () => {
            const loginBtn = document.getElementById('loginBtn');
            const userMenuBtn = document.getElementById('userMenuBtn');
            const userEmailSpan = document.getElementById('userEmail');
            const copyReferralModalBtn = document.getElementById('copyReferralModalBtn');
            const showMysteryResultModalBtn = document.getElementById('showMysteryResultModalBtn');
            const closeLogoutBtn = document.getElementById('closeLogout');
            const accountModalFeedback = document.getElementById('accountModalFeedback');
            const headerCoachmark = document.getElementById('headerCoachmark');
            const headerCoachmarkText = document.getElementById('headerCoachmarkText');
            const headerCoachmarkClose = document.getElementById('headerCoachmarkClose');

            const COACHMARK_LAST_SHOWN_KEY = 'home_header_coachmark_last_shown_at';
            const COACHMARK_COOLDOWN_MS = 6 * 60 * 60 * 1000; // 6 hours

            let coachmarkTarget = null;

            function hideCoachmark() {
                if (!headerCoachmark) return;
                headerCoachmark.style.display = 'none';
                coachmarkTarget = null;
            }

            function positionCoachmark() {
                if (!headerCoachmark || !coachmarkTarget) return;

                const targetRect = coachmarkTarget.getBoundingClientRect();
                const coachRect = headerCoachmark.getBoundingClientRect();
                const viewportPadding = 12;

                let top = targetRect.bottom + 10;
                let side = 'bottom';
                if (top + coachRect.height > window.innerHeight - viewportPadding) {
                    top = Math.max(viewportPadding, targetRect.top - coachRect.height - 10);
                    side = 'top';
                }

                let left = targetRect.left + targetRect.width / 2 - coachRect.width / 2;
                left = Math.max(viewportPadding, Math.min(left, window.innerWidth - coachRect.width - viewportPadding));

                const targetCenterX = targetRect.left + targetRect.width / 2;
                const minArrowLeft = 14;
                const maxArrowLeft = Math.max(minArrowLeft, coachRect.width - 24);
                const arrowLeft = Math.max(minArrowLeft, Math.min(targetCenterX - left - 6, maxArrowLeft));

                headerCoachmark.setAttribute('data-side', side);
                headerCoachmark.style.top = `${top}px`;
                headerCoachmark.style.left = `${left}px`;
                headerCoachmark.style.setProperty('--coachmark-arrow-left', `${arrowLeft}px`);
            }

            function shouldShowCoachmark() {
                try {
                    const lastShownAt = parseInt(localStorage.getItem(COACHMARK_LAST_SHOWN_KEY) || '0', 10) || 0;
                    if (Date.now() - lastShownAt < COACHMARK_COOLDOWN_MS) return false;
                    return true;
                } catch {
                    return false;
                }
            }

            function chooseCoachmarkMessage(isLoggedIn) {
                if (isLoggedIn) {
                    const options = [
                        'Click here to see Mystery Countdown results.',
                        'Click here to refer a friend.'
                    ];
                    return options[Math.floor(Math.random() * options.length)];
                }
                return 'Click here to log in.';
            }

            function showCoachmark(target, message) {
                if (!headerCoachmark || !headerCoachmarkText || !target || !message) return;
                coachmarkTarget = target;
                headerCoachmarkText.textContent = message;
                headerCoachmark.style.display = 'block';
                positionCoachmark();

                try {
                    localStorage.setItem(COACHMARK_LAST_SHOWN_KEY, String(Date.now()));
                } catch {
                    // ignore localStorage errors
                }
            }

            window.addEventListener('resize', positionCoachmark);
            window.addEventListener('scroll', positionCoachmark, { passive: true });
            headerCoachmarkClose?.addEventListener('click', hideCoachmark);
            document.addEventListener('click', (event) => {
                if (!headerCoachmark || headerCoachmark.style.display !== 'block') return;

                const clickedInsideCoachmark = headerCoachmark.contains(event.target);
                const clickedCoachmarkTarget = coachmarkTarget && coachmarkTarget.contains(event.target);

                if (!clickedInsideCoachmark && !clickedCoachmarkTarget) {
                    hideCoachmark();
                }
            });

            function setAccountFeedback(message, type) {
                if (!accountModalFeedback) return;
                accountModalFeedback.textContent = message;
                accountModalFeedback.style.display = 'block';

                const isError = type === 'error';
                const isSuccess = type === 'success';

                accountModalFeedback.style.borderColor = isError
                    ? 'rgba(239, 68, 68, 0.35)'
                    : isSuccess
                        ? 'rgba(16, 185, 129, 0.35)'
                        : 'rgba(148, 163, 184, 0.25)';

                accountModalFeedback.style.background = isError
                    ? 'rgba(239, 68, 68, 0.08)'
                    : isSuccess
                        ? 'rgba(16, 185, 129, 0.08)'
                        : 'rgba(2, 6, 23, 0.6)';

                accountModalFeedback.style.color = isError
                    ? '#fecaca'
                    : isSuccess
                        ? '#bbf7d0'
                        : '#f8fafc';
            }

            function flashButtonState(button, text, durationMs) {
                if (!button) return;
                const original = button.textContent;
                button.textContent = text;
                button.disabled = true;
                setTimeout(() => {
                    button.textContent = original;
                    button.disabled = false;
                }, durationMs);
            }
            
            if (reviewAuth.isLoggedIn()) {
                const userData = reviewAuth.getUserData();
                if (userData) {
                    loginBtn.style.display = 'none';
                    userMenuBtn.style.display = 'inline-flex';
                    userEmailSpan.textContent = userData.email.split('@')[0];

                    setTimeout(() => {
                        if (shouldShowCoachmark()) {
                            showCoachmark(userMenuBtn, chooseCoachmarkMessage(true));
                        }
                    }, 450);
                    
                    // Add logout functionality
                    userMenuBtn.addEventListener('click', () => {
                        hideCoachmark();
                        document.getElementById('logoutModal').style.display = 'flex';
                        if (accountModalFeedback) accountModalFeedback.style.display = 'none';
                    });

                    if (copyReferralModalBtn) {
                        copyReferralModalBtn.addEventListener('click', async () => {
                            try {
                                if (accountModalFeedback) accountModalFeedback.style.display = 'none';
                                let code = userData.referral_code;
                                if (!code && window.supabaseClient && userData.email) {
                                    const { data: fetched, error } = await window.supabaseClient
                                        .rpc('ensure_referral_code', { p_user_email: userData.email });
                                    if (!error && fetched) {
                                        code = fetched;
                                    }
                                }

                                if (!code) {
                                    setAccountFeedback('Referral code is not available yet. Please try again.', 'error');
                                    return;
                                }

                                const url = `${location.origin}${location.pathname.replace(/[^/]*$/, '')}review-login.html?ref=${encodeURIComponent(String(code).trim().toUpperCase())}&redirect=index.html`;

                                if (navigator.clipboard && navigator.clipboard.writeText) {
                                    await navigator.clipboard.writeText(url);
                                } else {
                                    const temp = document.createElement('textarea');
                                    temp.value = url;
                                    temp.setAttribute('readonly', '');
                                    temp.style.position = 'absolute';
                                    temp.style.left = '-9999px';
                                    document.body.appendChild(temp);
                                    temp.select();
                                    document.execCommand('copy');
                                    temp.remove();
                                }

                                setAccountFeedback('Referral link copied to clipboard.', 'success');
                                flashButtonState(copyReferralModalBtn, 'Copied!', 1200);
                            } catch (e) {
                                console.error('Copy referral link failed:', e);
                                setAccountFeedback('Could not copy referral link. Please try again.', 'error');
                            }
                        });
                    }

                    if (showMysteryResultModalBtn) {
                        showMysteryResultModalBtn.addEventListener('click', async () => {
                            try {
                                if (accountModalFeedback) accountModalFeedback.style.display = 'none';

                                if (typeof window.showMysteryResultsModal !== 'function') {
                                    setAccountFeedback('Mystery result is not ready yet. Please try again.', 'error');
                                    return;
                                }

                                const opened = await window.showMysteryResultsModal();
                                if (!opened) {
                                    setAccountFeedback('No mystery result is published yet.', 'error');
                                    return;
                                }

                                document.getElementById('logoutModal').style.display = 'none';
                            } catch (e) {
                                console.error('Show mystery result failed:', e);
                                setAccountFeedback('Could not open mystery result. Please try again.', 'error');
                            }
                        });
                    }
                }
            } else {
                loginBtn.style.display = 'inline-flex';
                userMenuBtn.style.display = 'none';

                setTimeout(() => {
                    if (shouldShowCoachmark()) {
                        showCoachmark(loginBtn, chooseCoachmarkMessage(false));
                    }
                }, 450);
                
                // Add glowing border animation to login button
                loginBtn.classList.add('animate-glow');
                
                // Stop animation after 60 seconds
                setTimeout(() => {
                    loginBtn.classList.remove('animate-glow');
                }, 60000);
                
                // Stop animation when user clicks
                loginBtn.addEventListener('click', () => {
                    hideCoachmark();
                    loginBtn.classList.remove('animate-glow');
                });
            }

            // Logout modal handlers
            closeLogoutBtn?.addEventListener('click', () => {
                document.getElementById('logoutModal').style.display = 'none';
            });

            document.getElementById('confirmLogout')?.addEventListener('click', () => {
                reviewAuth.clearSession();
                location.reload();
            });

            // Close modal on background click
            document.getElementById('logoutModal')?.addEventListener('click', (e) => {
                if (e.target.id === 'logoutModal') {
                    document.getElementById('logoutModal').style.display = 'none';
                }
            });

            // Global announcement modal handlers (content is injected by home-stats.js)
            const gaModal = document.getElementById('globalAnnouncementModal');
            const gaClose = document.getElementById('globalAnnouncementClose');
            const gaDismiss = document.getElementById('globalAnnouncementDismiss');

            const closeAnnouncement = () => {
                if (gaModal) gaModal.style.display = 'none';
            };

            gaClose?.addEventListener('click', closeAnnouncement);
            gaDismiss?.addEventListener('click', closeAnnouncement);
            gaModal?.addEventListener('click', (e) => {
                if (e.target?.id === 'globalAnnouncementModal') closeAnnouncement();
            });
        });
    </script>

    <div id="headerCoachmark" aria-live="polite" data-side="bottom">
        <button id="headerCoachmarkClose" aria-label="Dismiss tip">‚úï</button>
        <span id="headerCoachmarkText"></span>
    </div>

    <script src="js/home-stats.js"></script>
    <script src="js/landing.js"></script>

</body>
</html>